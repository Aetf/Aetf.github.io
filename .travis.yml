sudo: false
dist: trusty
addons:
    apt:
        packages:
            - language-pack-zh-hans
language: node_js
node_js:
    - 8
cache:
    directories:
        - "node_modules"
before_install:
    - npm install -g hexo-cli
install:
    - npm install
script:
    - hexo generate
before_deploy:
    - openssl aes-256-cbc -K $encrypted_730350046d35_key -iv $encrypted_730350046d35_iv -in tools/deploy_rsa.enc -out /tmp/deploy_rsa -d
    - eval "$(ssh-agent -s)"
    - chmod 600 /tmp/deploy_rsa
    - ssh-add /tmp/deploy_rsa
    - mkdir -p $HOME/.ssh
    - echo -e 'Host archvps\n\tUser aetf\n\tHostName archvps.unlimitedcodeworks.xyz\n\tPort 59901' >> $HOME/.ssh/config
    - ssh-keyscan -H -p 59901 archvps.unlimitedcodeworks.xyz 2>&1 | tee -a $HOME/.ssh/known_hosts
deploy:
    provider: script
    skip_cleanup: true
    script: hexo deploy
    on:
        branch: pelican-source
